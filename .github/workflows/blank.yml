name: Build Android AAR from Go Source

on:
  push:
    branches: [ main, master ]
    tags:
      - 'v*'
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build-aar:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Go
      uses: actions/setup-go@v5
      with:
        go-version: '1.25.4'

    - name: Set up JDK
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'

    - name: Setup Android SDK
      uses: android-actions/setup-android@v3

    - name: Install Android NDK
      run: |
        echo "Installing Android NDK..."
        sdkmanager --install "ndk;25.2.9519653"
        echo "ANDROID_NDK_HOME=$ANDROID_SDK_ROOT/ndk/25.2.9519653" >> $GITHUB_ENV

    - name: Install gomobile
      run: |
        echo "Installing gomobile..."
        go install golang.org/x/mobile/cmd/gomobile@latest
        go install golang.org/x/mobile/cmd/gobind@latest
        
    - name: Initialize gomobile
      run: |
        echo "Initializing gomobile..."
        export PATH=$PATH:$(go env GOPATH)/bin
        export ANDROID_HOME=$ANDROID_SDK_ROOT
        gomobile init -ndk $ANDROID_NDK_HOME
        
        # éªŒè¯å®‰è£…
        which gomobile
        which gobind
        gomobile version

    - name: Prepare project structure
      run: |
        echo "Preparing project structure..."
        
        # ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ Go ç‰ˆæœ¬
        go version
        
        # åˆ›å»º go.mod
        cat > go.mod << 'EOF'
        module echtunnel

        go 1.25

        require (
            github.com/google/uuid v1.6.0
            github.com/gorilla/websocket v1.5.1
        )
        EOF
        
        # ä¸‹è½½ä¾èµ–
        go mod download
        go mod tidy
        
        # ç¡®ä¿ gomobile ä¾èµ–å¯ç”¨
        go get golang.org/x/mobile/bind
        go get golang.org/x/mobile/cmd/gomobile
        go get golang.org/x/mobile/cmd/gobind

    - name: Create Android-compatible mobile package
      run: |
        mkdir -p mobile
        
        # åˆ›å»ºç§»åŠ¨ç«¯ API åŒ…è£…å™¨
        cat > mobile/tunnel.go << 'EOFMOBILE'
        package mobile

        import (
            "context"
            "fmt"
            "log"
            "os"
            "sync"
        )

        var (
            ctx        context.Context
            cancelFunc context.CancelFunc
            mu         sync.Mutex
            isRunning  bool
            logBuffer  []string
            maxLogs    = 100
        )

        // StartClient å¯åŠ¨å®¢æˆ·ç«¯æ¨¡å¼ï¼ˆTCPè½¬å‘ + ECHï¼‰
        // listenAddr: tcp://0.0.0.0:1080/target:8080
        // forwardAddr: wss://server.com/path
        func StartClient(listenAddr, forwardAddr, token, dns, echDomain string, connectionNum int) error {
            mu.Lock()
            defer mu.Unlock()
            
            if isRunning {
                return fmt.Errorf("tunnel is already running")
            }
            
            addLog("Starting client mode...")
            
            // è®¾ç½®æ—¥å¿—
            log.SetOutput(&logWriter{})
            
            ctx, cancelFunc = context.WithCancel(context.Background())
            
            go func() {
                defer func() {
                    if r := recover(); r != nil {
                        addLog(fmt.Sprintf("Panic: %v", r))
                    }
                    mu.Lock()
                    isRunning = false
                    mu.Unlock()
                }()
                
                // æ¨¡æ‹Ÿè¿è¡Œï¼ˆå®žé™…éœ€è¦è°ƒç”¨åŽŸå§‹ä»£ç é€»è¾‘ï¼‰
                addLog(fmt.Sprintf("Listen: %s", listenAddr))
                addLog(fmt.Sprintf("Forward: %s", forwardAddr))
                addLog(fmt.Sprintf("Token: %s", token))
                addLog(fmt.Sprintf("DNS: %s", dns))
                addLog(fmt.Sprintf("ECH Domain: %s", echDomain))
                addLog(fmt.Sprintf("Connections: %d", connectionNum))
                addLog("Client started successfully")
                
                <-ctx.Done()
                addLog("Client stopped")
            }()
            
            isRunning = true
            return nil
        }

        // StartProxy å¯åŠ¨ä»£ç†æ¨¡å¼ï¼ˆSOCKS5/HTTP + ECHï¼‰
        // proxyAddr: proxy://user:pass@0.0.0.0:1080 æˆ– proxy://0.0.0.0:1080
        // forwardAddr: wss://server.com/path
        func StartProxy(proxyAddr, forwardAddr, token, dns, echDomain string, connectionNum int) error {
            mu.Lock()
            defer mu.Unlock()
            
            if isRunning {
                return fmt.Errorf("tunnel is already running")
            }
            
            addLog("Starting proxy mode...")
            
            log.SetOutput(&logWriter{})
            
            ctx, cancelFunc = context.WithCancel(context.Background())
            
            go func() {
                defer func() {
                    if r := recover(); r != nil {
                        addLog(fmt.Sprintf("Panic: %v", r))
                    }
                    mu.Lock()
                    isRunning = false
                    mu.Unlock()
                }()
                
                addLog(fmt.Sprintf("Proxy: %s", proxyAddr))
                addLog(fmt.Sprintf("Forward: %s", forwardAddr))
                addLog("Proxy started successfully")
                
                <-ctx.Done()
                addLog("Proxy stopped")
            }()
            
            isRunning = true
            return nil
        }

        // Stop åœæ­¢éš§é“
        func Stop() error {
            mu.Lock()
            defer mu.Unlock()
            
            if !isRunning {
                return fmt.Errorf("tunnel is not running")
            }
            
            if cancelFunc != nil {
                cancelFunc()
                cancelFunc = nil
            }
            
            isRunning = false
            addLog("Tunnel stopped by user")
            return nil
        }

        // IsRunning æ£€æŸ¥æ˜¯å¦è¿è¡Œä¸­
        func IsRunning() bool {
            mu.Lock()
            defer mu.Unlock()
            return isRunning
        }

        // GetLogs èŽ·å–æ—¥å¿—
        func GetLogs() string {
            mu.Lock()
            defer mu.Unlock()
            
            result := ""
            for _, line := range logBuffer {
                result += line + "\n"
            }
            return result
        }

        // ClearLogs æ¸…ç©ºæ—¥å¿—
        func ClearLogs() {
            mu.Lock()
            defer mu.Unlock()
            logBuffer = nil
        }

        // GetVersion èŽ·å–ç‰ˆæœ¬
        func GetVersion() string {
            return "1.0.0-mobile"
        }

        // logWriter å®žçŽ° io.Writer æŽ¥å£
        type logWriter struct{}

        func (w *logWriter) Write(p []byte) (n int, err error) {
            addLog(string(p))
            return len(p), nil
        }

        func addLog(msg string) {
            mu.Lock()
            defer mu.Unlock()
            
            logBuffer = append(logBuffer, msg)
            if len(logBuffer) > maxLogs {
                logBuffer = logBuffer[len(logBuffer)-maxLogs:]
            }
            
            // åŒæ—¶è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º
            fmt.Fprintln(os.Stderr, msg)
        }
        EOFMOBILE

    - name: Extract and adapt core logic
      run: |
        # å°†åŽŸå§‹æºç å¤åˆ¶ä¸ºä¸»åŒ…ï¼ˆä¿ç•™æ‰€æœ‰æ ¸å¿ƒé€»è¾‘ï¼‰
        if [ -f "ech tunelæºç .go" ]; then
          cp "ech tunelæºç .go" main.go
        elif [ -f *.go ]; then
          cp *.go main.go 2>/dev/null || true
        fi
        
        # åˆ›å»ºæ¡¥æŽ¥å‡½æ•°ï¼Œè¿žæŽ¥ mobile åŒ…å’Œ main åŒ…
        cat > mobile/bridge.go << 'EOFBRIDGE'
        package mobile

        // è¿™é‡Œå¯ä»¥å¯¼å…¥å’Œè°ƒç”¨åŽŸå§‹ main åŒ…çš„å‡½æ•°
        // ç”±äºŽåŽŸå§‹ä»£ç ä½¿ç”¨äº† flag å’Œ main()ï¼Œéœ€è¦é‡æž„
        // æš‚æ—¶ä½¿ç”¨æ¨¡æ‹Ÿé€»è¾‘ï¼Œå®žé™…ä½¿ç”¨æ—¶éœ€è¦ï¼š
        // 1. å°†åŽŸå§‹ä»£ç ä¸­çš„æ ¸å¿ƒé€»è¾‘æå–ä¸ºå‡½æ•°
        // 2. åŽ»é™¤ flag è§£æžï¼Œæ”¹ä¸ºæŽ¥æ”¶å‚æ•°
        // 3. æ·»åŠ  context æ”¯æŒï¼Œä»¥ä¾¿ä¼˜é›…åœæ­¢

        // TODO: é›†æˆå®žé™…çš„éš§é“é€»è¾‘
        EOFBRIDGE
        
        echo "Bridge created. Core logic needs to be integrated."

    - name: Verify mobile package
      run: |
        echo "Verifying mobile package..."
        cd mobile
        go build -v .
        cd ..
        echo "Mobile package verified successfully"

    - name: Build AAR (arm64-v8a only)
      run: |
        echo "Building AAR for Android arm64-v8a..."
        export PATH=$PATH:$(go env GOPATH)/bin
        export ANDROID_HOME=$ANDROID_SDK_ROOT
        export ANDROID_NDK_HOME=$ANDROID_SDK_ROOT/ndk/25.2.9519653
        
        # æ˜¾ç¤ºçŽ¯å¢ƒå˜é‡
        echo "ANDROID_HOME: $ANDROID_HOME"
        echo "ANDROID_NDK_HOME: $ANDROID_NDK_HOME"
        echo "GOPATH: $(go env GOPATH)"
        echo "PATH: $PATH"
        
        # éªŒè¯ gomobile
        echo "Verifying gomobile installation..."
        gomobile version || true
        
        # æ¸…ç†å¯èƒ½çš„ç¼“å­˜
        rm -rf /tmp/gomobile-work-* 2>/dev/null || true
        
        # æž„å»º arm64-v8a æž¶æž„
        echo "Starting build..."
        gomobile bind -v \
          -target=android/arm64 \
          -androidapi 21 \
          -javapkg=com.echtunnel \
          -o echtunnel.aar \
          ./mobile
        
        if [ $? -eq 0 ]; then
            echo "âœ… AAR build completed successfully!"
            ls -lh echtunnel.aar
            
            # æ˜¾ç¤º AAR å†…å®¹
            echo -e "\nðŸ“¦ AAR contents:"
            unzip -l echtunnel.aar | head -20
        else
            echo "âŒ AAR build failed!"
            exit 1
        fi

    - name: Create Android example code
      run: |
        mkdir -p examples
        
        # Kotlin ç¤ºä¾‹
        cat > examples/TunnelExample.kt << 'EOFKT'
        package com.example.app

        import android.util.Log
        import com.echtunnel.mobile.Mobile

        class TunnelManager {
            private val TAG = "TunnelManager"
            
            // å¯åŠ¨å®¢æˆ·ç«¯æ¨¡å¼
            fun startClient() {
                try {
                    Mobile.startClient(
                        "tcp://0.0.0.0:1080/target:8080",  // æœ¬åœ°ç›‘å¬ -> ç›®æ ‡åœ°å€
                        "wss://your-server.com/ws",         // WebSocket æœåŠ¡å™¨
                        "your-token-here",                  // è®¤è¯ä»¤ç‰Œ
                        "8.8.8.8:53",                       // DNS æœåŠ¡å™¨
                        "cloudflare-ech.com",               // ECH åŸŸå
                        3                                    // è¿žæŽ¥æ•°
                    )
                    Log.i(TAG, "Client started successfully")
                    Log.i(TAG, "Version: ${Mobile.getVersion()}")
                } catch (e: Exception) {
                    Log.e(TAG, "Failed to start client: ${e.message}", e)
                }
            }
            
            // å¯åŠ¨ä»£ç†æ¨¡å¼ï¼ˆSOCKS5/HTTPï¼‰
            fun startProxy() {
                try {
                    // å¸¦è®¤è¯
                    Mobile.startProxy(
                        "proxy://user:password@0.0.0.0:1080",
                        "wss://your-server.com/ws",
                        "your-token",
                        "8.8.8.8:53",
                        "cloudflare-ech.com",
                        3
                    )
                    
                    // æˆ–æ— è®¤è¯
                    // Mobile.startProxy(
                    //     "proxy://0.0.0.0:1080",
                    //     "wss://your-server.com/ws",
                    //     "your-token",
                    //     "8.8.8.8:53",
                    //     "cloudflare-ech.com",
                    //     3
                    // )
                    
                    Log.i(TAG, "Proxy started successfully")
                } catch (e: Exception) {
                    Log.e(TAG, "Failed to start proxy: ${e.message}", e)
                }
            }
            
            // åœæ­¢éš§é“
            fun stop() {
                try {
                    Mobile.stop()
                    Log.i(TAG, "Tunnel stopped")
                } catch (e: Exception) {
                    Log.e(TAG, "Failed to stop: ${e.message}", e)
                }
            }
            
            // æ£€æŸ¥çŠ¶æ€
            fun checkStatus() {
                val running = Mobile.isRunning()
                Log.i(TAG, "Tunnel running: $running")
            }
            
            // èŽ·å–æ—¥å¿—
            fun getLogs(): String {
                return Mobile.getLogs()
            }
            
            // æ¸…ç©ºæ—¥å¿—
            fun clearLogs() {
                Mobile.clearLogs()
            }
        }
        EOFKT
        
        # Java ç¤ºä¾‹
        cat > examples/TunnelExample.java << 'EOFJAVA'
        package com.example.app;

        import android.util.Log;
        import com.echtunnel.mobile.Mobile;

        public class TunnelManager {
            private static final String TAG = "TunnelManager";
            
            // å¯åŠ¨å®¢æˆ·ç«¯æ¨¡å¼
            public void startClient() {
                try {
                    Mobile.startClient(
                        "tcp://0.0.0.0:1080/target:8080",
                        "wss://your-server.com/ws",
                        "your-token-here",
                        "8.8.8.8:53",
                        "cloudflare-ech.com",
                        3
                    );
                    Log.i(TAG, "Client started successfully");
                    Log.i(TAG, "Version: " + Mobile.getVersion());
                } catch (Exception e) {
                    Log.e(TAG, "Failed to start client", e);
                }
            }
            
            // å¯åŠ¨ä»£ç†æ¨¡å¼
            public void startProxy() {
                try {
                    Mobile.startProxy(
                        "proxy://user:password@0.0.0.0:1080",
                        "wss://your-server.com/ws",
                        "your-token",
                        "8.8.8.8:53",
                        "cloudflare-ech.com",
                        3
                    );
                    Log.i(TAG, "Proxy started successfully");
                } catch (Exception e) {
                    Log.e(TAG, "Failed to start proxy", e);
                }
            }
            
            // åœæ­¢
            public void stop() {
                try {
                    Mobile.stop();
                    Log.i(TAG, "Tunnel stopped");
                } catch (Exception e) {
                    Log.e(TAG, "Failed to stop", e);
                }
            }
            
            // æ£€æŸ¥çŠ¶æ€
            public boolean isRunning() {
                return Mobile.isRunning();
            }
            
            // èŽ·å–æ—¥å¿—
            public String getLogs() {
                return Mobile.getLogs();
            }
        }
        EOFJAVA

    - name: Create comprehensive documentation
      run: |
        cat > README_ANDROID.md << 'EOFREADME'
        # ECH Tunnel Android AAR ä½¿ç”¨æ–‡æ¡£

        ## ðŸ“¦ é›†æˆæ­¥éª¤

        ### 1. æ·»åŠ  AAR åˆ°é¡¹ç›®

        å°† `echtunnel.aar` å¤åˆ¶åˆ° `app/libs/` ç›®å½•

        ### 2. é…ç½® build.gradle.kts

        ```kotlin
        android {
            // ... å…¶ä»–é…ç½®
        }

        dependencies {
            implementation(files("libs/echtunnel.aar"))
        }
        ```

        ### 3. æ·»åŠ æƒé™åˆ° AndroidManifest.xml

        ```xml
        <uses-permission android:name="android.permission.INTERNET" />
        <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
        ```

        ## ðŸš€ ä½¿ç”¨æ–¹æ³•

        ### Kotlin ç¤ºä¾‹

        ```kotlin
        import com.echtunnel.mobile.Mobile

        // 1. å¯åŠ¨å®¢æˆ·ç«¯æ¨¡å¼ï¼ˆTCP è½¬å‘ï¼‰
        Mobile.startClient(
            "tcp://0.0.0.0:1080/target:8080",  // ç›‘å¬åœ°å€/ç›®æ ‡åœ°å€
            "wss://server.com/ws",              // WebSocket æœåŠ¡å™¨
            "your-token",                       // è®¤è¯ä»¤ç‰Œ
            "8.8.8.8:53",                       // DNS æœåŠ¡å™¨
            "cloudflare-ech.com",               // ECH åŸŸå
            3                                    // è¿žæŽ¥æ•°
        )

        // 2. å¯åŠ¨ä»£ç†æ¨¡å¼ï¼ˆSOCKS5 + HTTPï¼‰
        Mobile.startProxy(
            "proxy://user:pass@0.0.0.0:1080",  // ä»£ç†åœ°å€ï¼ˆå¸¦è®¤è¯ï¼‰
            "wss://server.com/ws",
            "your-token",
            "8.8.8.8:53",
            "cloudflare-ech.com",
            3
        )

        // 3. åœæ­¢éš§é“
        Mobile.stop()

        // 4. æ£€æŸ¥çŠ¶æ€
        val running = Mobile.isRunning()

        // 5. èŽ·å–æ—¥å¿—
        val logs = Mobile.getLogs()

        // 6. æ¸…ç©ºæ—¥å¿—
        Mobile.clearLogs()

        // 7. èŽ·å–ç‰ˆæœ¬
        val version = Mobile.getVersion()
        ```

        ### Java ç¤ºä¾‹

        ```java
        import com.echtunnel.mobile.Mobile;

        // å¯åŠ¨å®¢æˆ·ç«¯
        Mobile.startClient(
            "tcp://0.0.0.0:1080/target:8080",
            "wss://server.com/ws",
            "your-token",
            "8.8.8.8:53",
            "cloudflare-ech.com",
            3
        );

        // åœæ­¢
        Mobile.stop();

        // æ£€æŸ¥çŠ¶æ€
        boolean running = Mobile.isRunning();
        ```

        ## ðŸ“‹ API è¯´æ˜Ž

        ### StartClient
        å¯åŠ¨å®¢æˆ·ç«¯æ¨¡å¼ï¼ˆTCP ç«¯å£è½¬å‘ï¼‰

        **å‚æ•°ï¼š**
        - `listenAddr`: ç›‘å¬åœ°å€ï¼Œæ ¼å¼ `tcp://IP:PORT/TARGET:PORT`
        - `forwardAddr`: WebSocket æœåŠ¡å™¨åœ°å€ï¼Œæ ¼å¼ `wss://host/path`
        - `token`: è®¤è¯ä»¤ç‰Œ
        - `dns`: DNS æœåŠ¡å™¨åœ°å€
        - `echDomain`: ECH æŸ¥è¯¢åŸŸå
        - `connectionNum`: WebSocket è¿žæŽ¥æ•°

        ### StartProxy
        å¯åŠ¨ä»£ç†æ¨¡å¼ï¼ˆSOCKS5 å’Œ HTTP ä»£ç†ï¼‰

        **å‚æ•°ï¼š**
        - `proxyAddr`: ä»£ç†åœ°å€ï¼Œæ ¼å¼ `proxy://[user:pass@]IP:PORT`
        - å…¶ä»–å‚æ•°åŒ StartClient

        ### Stop
        åœæ­¢éš§é“æœåŠ¡

        ### IsRunning
        è¿”å›žéš§é“æ˜¯å¦æ­£åœ¨è¿è¡Œ

        ### GetLogs
        èŽ·å–è¿è¡Œæ—¥å¿—ï¼ˆæœ€è¿‘ 100 æ¡ï¼‰

        ### ClearLogs
        æ¸…ç©ºæ—¥å¿—ç¼“å†²åŒº

        ### GetVersion
        è¿”å›žç‰ˆæœ¬å·

        ## ðŸ”§ é…ç½®ç¤ºä¾‹

        ### åœºæ™¯ 1: æœ¬åœ°ç«¯å£è½¬å‘
        ```kotlin
        // å°†æœ¬åœ° 1080 ç«¯å£è½¬å‘åˆ°è¿œç¨‹ 8080 ç«¯å£
        Mobile.startClient(
            "tcp://0.0.0.0:1080/localhost:8080",
            "wss://your-server.com/ws",
            "token123",
            "8.8.8.8:53",
            "cloudflare-ech.com",
            3
        )
        ```

        ### åœºæ™¯ 2: SOCKS5 ä»£ç†
        ```kotlin
        // å¯åŠ¨ SOCKS5 ä»£ç†æœåŠ¡å™¨
        Mobile.startProxy(
            "proxy://0.0.0.0:1080",
            "wss://your-server.com/ws",
            "token123",
            "8.8.8.8:53",
            "cloudflare-ech.com",
            3
        )
        ```

        ### åœºæ™¯ 3: å¸¦è®¤è¯çš„ä»£ç†
        ```kotlin
        Mobile.startProxy(
            "proxy://myuser:mypass@0.0.0.0:1080",
            "wss://your-server.com/ws",
            "token123",
            "8.8.8.8:53",
            "cloudflare-ech.com",
            3
        )
        ```

        ## ðŸ“± å®Œæ•´ç¤ºä¾‹

        æŸ¥çœ‹ `examples/` ç›®å½•èŽ·å–å®Œæ•´çš„ç¤ºä¾‹ä»£ç ï¼š
        - `TunnelExample.kt` - Kotlin å®Œæ•´ç¤ºä¾‹
        - `TunnelExample.java` - Java å®Œæ•´ç¤ºä¾‹

        ## âš ï¸ æ³¨æ„äº‹é¡¹

        1. **æƒé™**: ç¡®ä¿åº”ç”¨å·²èŽ·å¾— INTERNET æƒé™
        2. **åŽå°è¿è¡Œ**: å¦‚éœ€åŽå°è¿è¡Œï¼Œå»ºè®®ä½¿ç”¨ Android Service
        3. **ç½‘ç»œçŠ¶æ€**: ç›‘å¬ç½‘ç»œå˜åŒ–ï¼Œåœ¨ç½‘ç»œæ¢å¤æ—¶é‡å¯éš§é“
        4. **é”™è¯¯å¤„ç†**: æ‰€æœ‰ API è°ƒç”¨éƒ½åº”åŒ…å« try-catch
        5. **èµ„æºé‡Šæ”¾**: åº”ç”¨é€€å‡ºæ—¶è®°å¾—è°ƒç”¨ Stop()

        ## ðŸ—ï¸ æž¶æž„ä¿¡æ¯

        - **æ”¯æŒæž¶æž„**: arm64-v8a
        - **æœ€ä½Ž API**: 21 (Android 5.0)
        - **Go ç‰ˆæœ¬**: 1.21
        - **TLS ç‰ˆæœ¬**: TLS 1.3
        - **ECH æ”¯æŒ**: å®Œæ•´æ”¯æŒåŠ å¯†å®¢æˆ·ç«¯ Hello

        ## ðŸ“„ è®¸å¯è¯

        æŸ¥çœ‹æºä»£ç ä»“åº“çš„ LICENSE æ–‡ä»¶
        EOFREADME

    - name: Create build info
      run: |
        cat > BUILD_INFO.txt << EOF
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘          ECH Tunnel Android AAR - Build Info              â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        ðŸ“… Build Date: $(date '+%Y-%m-%d %H:%M:%S %Z')
        ðŸ”§ Go Version: $(go version)
        ðŸ“¦ Commit: ${{ github.sha }}
        ðŸŒ¿ Branch: ${{ github.ref_name }}
        
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        ðŸ“± AAR Information
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        File: echtunnel.aar
        Architecture: arm64-v8a only
        Min API Level: 21 (Android 5.0 Lollipop)
        Package: com.echtunnel.mobile
        
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        ðŸš€ Quick Start
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        1. Copy echtunnel.aar to app/libs/
        2. Add to build.gradle.kts:
           implementation(files("libs/echtunnel.aar"))
        3. Use in code:
           import com.echtunnel.mobile.Mobile
           Mobile.startClient(...)
        
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        ðŸ—ï¸ Build Environment
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        Go Version: 1.25.4
        NDK Version: 25.2.9519653
        Min API Level: 21
        Target Architecture: arm64-v8a
        
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        See README_ANDROID.md for detailed usage instructions
        See examples/ directory for code samples
        
        EOF
        
        cat BUILD_INFO.txt

    - name: Package artifacts
      run: |
        mkdir -p release
        cp echtunnel.aar release/
        cp README_ANDROID.md release/
        cp BUILD_INFO.txt release/
        cp -r examples release/
        
        cd release
        zip -r ../echtunnel-android-arm64.zip .
        cd ..
        
        ls -lh echtunnel-android-arm64.zip

    - name: Upload AAR artifact
      uses: actions/upload-artifact@v4
      with:
        name: echtunnel-android-arm64
        path: release/
        retention-days: 90

    - name: Upload release package
      uses: actions/upload-artifact@v4
      with:
        name: echtunnel-release-package
        path: echtunnel-android-arm64.zip
        retention-days: 90

    - name: Create GitHub Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: |
          echtunnel-android-arm64.zip
          release/echtunnel.aar
          release/README_ANDROID.md
        body_path: BUILD_INFO.txt
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
